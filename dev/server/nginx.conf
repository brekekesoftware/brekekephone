# main https server
server {
  listen 443 ssl;
  ssl_certificate /etc/letsencrypt/live/apps.brekeke.com/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/apps.brekeke.com/privkey.pem;
  ssl_trusted_certificate /etc/letsencrypt/live/apps.brekeke.com/chain.pem;
  server_name apps.brekeke.com;
  root /var/www/apps/build;
  #
  # static
  location /0 {
    root /var/www/apps-static;
  }
  #
  # api
  location /api {
    proxy_pass http://localhost:3030;
  }
  #
  # live web version
  location = /phone {
    return 301 https://$server_name/phone/;
  }
  location /phone {
    root /var/www/brekekephone;
    try_files $uri /phone/index.html;
  }
  #
  # apple aasa.json
  location = /.well-known/apple-app-site-association {
    default_type application/json;
  }
  #
  # other
  location / {
    try_files $uri /index.html;
  }
}

#
# redirect http to https
server {
  listen 80;
  server_name apps.brekeke.com;
  return 301 https://$server_name$request_uri;
}
